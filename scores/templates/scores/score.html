{% extends 'scores/base.html' %}

{% load static %}

{% block title %}{{ score.title|default:"Untitled" }}{% endblock %}

{% block description %}Sheet music typeset with LilyPond - {{ score.title }}{% endblock %}

{% block head_extra %}
  <script>
    function share() {
      copyLinkToClipboard()
      showLinkCopiedToClipboardMessage()
    }

    function copyLinkToClipboard() {
      var input = document.createElement('input')
      document.body.appendChild(input);
      input.value = 'https://www.mymusichere.me/{{ score.slug }}';
      input.select();
      document.execCommand('copy');
      document.body.removeChild(input);
    }

    function showLinkCopiedToClipboardMessage() {
      var messageDiv = document.getElementById('message')

      if (messageDiv.hasChildNodes()) return;

      var message = document.createElement('div')
      message.setAttribute('class', 'alert alert-primary fade show m-0')
      message.setAttribute('role', 'alert')
      message.textContent = 'Link copied to clipboard'

      messageDiv.appendChild(message)

      setTimeout(function closeAlert() {
        $('.alert').alert('close')
      }, 3000)
    }
  </script>
{% endblock head_extra %}

{% block navbar %}
  <nav class="navbar navbar-expand-sm navbar-dark bg-dark">
    <a href="../" class="btn btn-link icon"><i class="fas fa-arrow-left"></i></a>

    <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="btn btn-dark btn-nav" href="{% static score.get_path_to_pdf %}" download>download</a>
        </li>
        <li class="nav-item">
          <button class="btn btn-dark btn-nav" onclick="share()">share</button>
        </li>
        <li class="nav-item">
          <a class="btn btn-dark btn-nav" href="{{ score.get_link_to_source }}">view source</a>
        </li>
      </ul>
    </div>
  </nav>
{% endblock navbar %}

{% block content %}
  <main class="container-fluid text-center">
    <div id="message"></div>

    {% for page in score.get_paths_to_pages %}
    <img src="{% static page %}" class="img-fluid" alt="Score page {{ forloop.counter }}"/>
    {% if not forloop.last %}
    <hr>
    {% endif %}
    {% empty %}
    <p>Sorry, sheet music for this piece is not available.</p>
    {% endfor %}
  </main>
{% endblock content %}
